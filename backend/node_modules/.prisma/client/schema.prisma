datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String
  role      String   @default("STAFF") // ADMIN / MANAGER / STAFF
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  assignedTickets Ticket[]
  comments        Comment[]
}

model Property {
  id        Int      @id @default(autoincrement())
  name      String
  address   String
  city      String?
  state     String?
  zip       String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  units Unit[]
}

model Unit {
  id         Int      @id @default(autoincrement())
  property   Property @relation(fields: [propertyId], references: [id])
  propertyId Int
  unitNumber String
  status     String   @default("VACANT") // VACANT / OCCUPIED / NOTICE
  beds       Int?
  baths      Int?
  sqft       Int?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  tenants Tenant[]
  tickets Ticket[]
}

model Tenant {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  phone     String?
  unit      Unit     @relation(fields: [unitId], references: [id])
  unitId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  tickets Ticket[]
}

model Ticket {
  id           Int      @id @default(autoincrement())
  unit         Unit     @relation(fields: [unitId], references: [id])
  unitId       Int
  tenant       Tenant   @relation(fields: [tenantId], references: [id])
  tenantId     Int
  title        String
  description  String
  priority     String   @default("MEDIUM") // LOW / MEDIUM / HIGH / URGENT
  status       String   @default("OPEN") // OPEN / IN_PROGRESS / RESOLVED / CLOSED
  assignedTo   User?    @relation(fields: [assignedToId], references: [id])
  assignedToId Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  comments Comment[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  ticket    Ticket   @relation(fields: [ticketId], references: [id])
  ticketId  Int
  author    User     @relation(fields: [authorId], references: [id])
  authorId  Int
  body      String
  createdAt DateTime @default(now())
}
